{{define "view"}}

<h1>User Management</h1>

{{if .Query.Get "edit"}}
	<p><a href="?{{URL (QueryReplace .Query "edit" nil)}}">Back</a></p>
	<p>Editing {{.Vars.User.Email}}</p>
{{else}}
	<form class="bag">
		<input type="search" aria-label="Search" name="search" value="{{.Query.Get "search"}}" placeholder="Search" autofocus class="grow">
		<button>Search</button>
	</form>

	<table class="management">
		<tr>
			<th>Email</th>
			<th>Last Login</th>
			<th></th>
		</tr>

		{{range .Vars.Users.Page.Rows}}
			<tr>
				<td><a href="mailto:{{.Email}}">{{.Email}}</a></td>
				<td data-locale-datetime>
					{{if not .LastLoggedInAt.IsZero}}
						{{FormatTime .LastLoggedInAt "RFC3339"}}
					{{end}}
				</td>
				<td class="text-right"><a href="?{{URL (QueryReplace $.Query "edit" .ID)}}">Edit</a></td>
			</tr>
		{{else}}
			<tr class="management__empty">
				<td colspan="3">No data found</td>
			</tr>
		{{end}}
	</table>

	{{template "pagination" .WithBook .Vars.Users}}
{{end}}

{{end}}
