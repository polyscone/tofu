{{define "view.master"}}{{template "master.site" .}}{{end}}

{{define "view.head"}}

<div class="center">
	<h1>{{.T "site.system.recovery.title"}}</h1>
</div>

{{end}}

{{define "view.body"}}

<div class="center">
	{{if .Passport.System.CanBackup}}
		<h3>{{.T "site.system.recovery.backup_title"}}</h3>

		<form action="{{Path "system.recovery.backup"}}" target="_blank">
			{{$host := ReplaceAll .URL.Host ":" "-"}}
			{{$date := (.Now.UTC).Format "2006-01-02"}}
			{{$filename := printf "%v system backup %v" $host $date}}

			{{template "com.form.text" .WithProps
				"Label" (.T "site.system.recovery.backup_filename_label")
				"Name" "filename"
				"Value" $filename
				"Required" true
				"MaxLength" 150
				"Pattern" `[a-zA-Z0-9\s\(\)\[\].\-]+`
			}}

			<div class="bag reverse">
				<button>{{.T "site.system.recovery.backup_button"}}</button>
			</div>
		</form>
	{{end}}

	{{if .Passport.System.CanRestore}}
		<h3>{{.T "site.system.recovery.restore_title"}}</h3>

		<div class="warning-banner">
			{{.T "p" "site.system.recovery.restore_warning"}}
		</div>

		<form action="{{Path "system.recovery.restore.post"}}?_csrf={{.CSRF.Token}}" method="POST" enctype="multipart/form-data">
			{{template "com.form.csrf" .}}

			{{template "com.form.file" .WithProps
				"Label" (.T "site.system.recovery.restore_archive_label")
				"Name" "restore-archive"
				"Required" true
				"Accept" ".zip,application/zip,application/x-zip-compressed"
			}}

			<div class="bag reverse">
				<button>{{.T "site.system.recovery.restore_button"}}</button>
			</div>
		</form>
	{{end}}
</div>

{{end}}
